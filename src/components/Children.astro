---
import { contentTree } from '@scripts/content-tree';

let { content, filter, value } = Astro.props;

if (!content) {
    content = contentTree;
}

const findObjectBySlug = (obj, slug) => {
    // Base case: If obj is not an object or is null, return null
    if (!obj || typeof obj !== 'object') {
        return null;
    }

    // Check if the current object has the specified slug
    if (obj.slug === slug) {
        return obj;
    }

    // Check if the current object has children
    if (obj.children && obj.children.length > 0) {
        // Recursively search through the children
        for (const child of obj.children) {
            const result = findObjectBySlug(child, slug);

            // If the object with the specified slug is found in any child, return it
            if (result !== null) {
                return result;
            }
        }
    }

    // If the object is not found, return null
    return null;
};

// TODO: Account for trailing slash in pathname (e.g. /about/ vs /about)
let doc = findObjectBySlug(content[0], Astro.url.pathname.substring(1));

if (doc.children && doc.children.length > 0 && filter && value) {
    doc = {
        ...doc,
        children: doc.children.filter(child => child.data[filter] === value)
    };
} else if (doc.children && doc.children.length > 0 && doc.data.hideChildPages) {
    doc = {
        ...doc,
        children: []
    };
}
---

{(doc.children && doc.children.length > 0) && (
    <div class="row">
        {doc.children.map(child => (
            <div class="col-lg-6 col-xl-4 pb-4">
                <div class="card card-body card-link card-index">
                    <div class="circle">
                        <i class="fa-solid fa-file" aria-hidden="true"></i>
                    </div>
                    <div class="d-flex flex-column ps-3">
                        <p class="h5 fw-bold card-title"><a class="stretched-link" href={`/${child.slug}`} title={child.data.title}>{child.data.title}</a></p>
                        <p class="card-content">{child.data.description}</p>
                    </div>
                </div>
            </div>
        ))}
    </div>
)}
