---
import { slugId } from '@scripts/helpers';

const { doc, paddingClass, listItemClass } = Astro.props;
const activeSlug = Astro.url.pathname.substring(1);

const isActiveChild = () => {
    // Create a stack to store documents to be checked
    const stack = [doc];
    
    // Iterate through the stack until it's empty
    while (stack.length > 0) {
        // Pop the last document from the stack
        const currentDoc = stack.pop();
        
        // Check if the current document's slug matches the activeSlug
        if (currentDoc.slug === activeSlug) {
            return true;
        }
        
        // If the current document has children, push them onto the stack to explore further
        if (currentDoc.children) {
            for (const child of currentDoc.children) {
                stack.push(child);
            }
        }
    }
    
    // If the activeSlug is not found in any document, return false
    return false;
};

const isActivePage = () => {
    return doc.slug === activeSlug;
};
---

<li class={`nav-item ${listItemClass ? `nav-item-blue ${isActiveChild() ? 'active' : ''}` : ''}`}>
    <div class={`nav-link nav-link-collapse d-flex ${isActiveChild() ? 'active' : ''} ${isActivePage() ? 'active-page' : ''}`}>
        <button class={`btn btn-collapse rounded-0 border-0 ${paddingClass} ${isActiveChild() ? '' : 'collapsed'}`} type="button" data-bs-toggle="collapse" aria-expanded={`${isActiveChild() ? 'true' : 'false'}`} aria-controls={slugId(`id-${doc.slug}`)} aria-label="collapse or expand navigation" href={slugId(`#id-${doc.slug}`)}></button>
        <a href={`/${doc.slug}`}>{doc.data.title}</a>
    </div>
    <div class={`collapse ${isActiveChild() ? 'show' : ''}`} id={slugId(`id-${doc.slug}`)}>
        <ul class="navbar-nav">
            <slot />
        </ul>
    </div>
</li>
